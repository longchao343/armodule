<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Kalman Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="classes.html"><span>Class&nbsp;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="namespacealvar.html">alvar</a>::<a class="el" href="classalvar_1_1_kalman.html">Kalman</a>
  </div>
</div>
<div class="contents">
<h1>Kalman Class Reference</h1><!-- doxytag: class="alvar::Kalman" --><!-- doxytag: inherits="alvar::KalmanCore" -->
<p><a class="el" href="classalvar_1_1_kalman.html" title="Kalman implementation.">Kalman</a> implementation.  
<a href="#_details">More...</a></p>

<p><code>#include &lt;<a class="el" href="_kalman_8h_source.html">Kalman.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for Kalman:</div>
<div class="dynsection">
 <div class="center">
  <img src="classalvar_1_1_kalman.png" usemap="#Kalman_map" alt=""/>
  <map id="Kalman_map" name="Kalman_map">
<area href="classalvar_1_1_kalman_core.html" alt="KalmanCore" shape="rect" coords="0,0,81,24"/>
<area href="classalvar_1_1_kalman_ekf.html" alt="KalmanEkf" shape="rect" coords="0,112,81,136"/>
</map>
 </div>
</div>

<p><a href="classalvar_1_1_kalman-members.html">List of all members.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classalvar_1_1_kalman.html#add0d3881af973546a257fd6e1dcd8298">Kalman</a> (int _n)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Constructor.  <a href="#add0d3881af973546a257fd6e1dcd8298"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ad0c6513d9400e6a237ef6e393135d0bb"></a><!-- doxytag: member="alvar::Kalman::~Kalman" ref="ad0c6513d9400e6a237ef6e393135d0bb" args="()" -->
&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classalvar_1_1_kalman.html#ad0c6513d9400e6a237ef6e393135d0bb">~Kalman</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Destructor. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classalvar_1_1_kalman.html#aedfe0c641afbd94cf40850de332a0fb4">update_F</a> (unsigned long tick)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">CvMat *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classalvar_1_1_kalman.html#a60532ff38a0447a6e4e1f78f108284a3">predict</a> (unsigned long tick)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Predict the <a class="el" href="classalvar_1_1_kalman.html" title="Kalman implementation.">Kalman</a> state vector for the given time step This calls <em>updateF</em> for updating the transition matrix based on the real time step.  <a href="#a60532ff38a0447a6e4e1f78f108284a3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a2ddfde263de0bf9a41e5a304ed1f4e30"></a><!-- doxytag: member="alvar::Kalman::predict_update" ref="a2ddfde263de0bf9a41e5a304ed1f4e30" args="(KalmanSensor *sensor, unsigned long tick)" -->
CvMat *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classalvar_1_1_kalman.html#a2ddfde263de0bf9a41e5a304ed1f4e30">predict_update</a> (<a class="el" href="classalvar_1_1_kalman_sensor.html">KalmanSensor</a> *sensor, unsigned long tick)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Predict the <a class="el" href="classalvar_1_1_kalman.html" title="Kalman implementation.">Kalman</a> state vector for the given time step and update the state using the <a class="el" href="classalvar_1_1_kalman.html" title="Kalman implementation.">Kalman</a> gain.</p>
<ul>
<li>Calls first the predict to ensure that the prediction is based on same timestep as the update</li>
<li>K = P_pred * trans(H) * inv(H*P_pred*trans(H) + R)</li>
<li>x = x_pred + K* ( z - H*x_pred)</li>
<li>P = (I - K*H) * P_pred. </li>
</ul>
<br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aae8a46fb6f855cd7bf4049d2bce7c986"></a><!-- doxytag: member="alvar::Kalman::seconds_since_update" ref="aae8a46fb6f855cd7bf4049d2bce7c986" args="(unsigned long tick)" -->
double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classalvar_1_1_kalman.html#aae8a46fb6f855cd7bf4049d2bce7c986">seconds_since_update</a> (unsigned long tick)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Helper method. <br/></td></tr>
<tr><td colspan="2"><h2>Public Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ad7389e413ec544259e68b4a19f19da0f"></a><!-- doxytag: member="alvar::Kalman::P" ref="ad7389e413ec544259e68b4a19f19da0f" args="" -->
CvMat *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classalvar_1_1_kalman.html#ad7389e413ec544259e68b4a19f19da0f">P</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The error covariance matrix describing the accuracy of the state estimate. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="afecad2d06d5bf8a60605d632a271b74c"></a><!-- doxytag: member="alvar::Kalman::Q" ref="afecad2d06d5bf8a60605d632a271b74c" args="" -->
CvMat *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classalvar_1_1_kalman.html#afecad2d06d5bf8a60605d632a271b74c">Q</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The covariance matrix for the process noise. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a040471519e51e99c8515780d0ed18667"></a><!-- doxytag: member="alvar::Kalman::P_pred" ref="a040471519e51e99c8515780d0ed18667" args="" -->
CvMat *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classalvar_1_1_kalman.html#a040471519e51e99c8515780d0ed18667">P_pred</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The predicted error covariance matrix. <br/></td></tr>
<tr><td colspan="2"><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a67f35c0a2ba5542a35b80f4e953da470"></a><!-- doxytag: member="alvar::Kalman::predict_P" ref="a67f35c0a2ba5542a35b80f4e953da470" args="()" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><b>predict_P</b> ()</td></tr>
<tr><td colspan="2"><h2>Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a4121d0507501f60021622d833c373e8a"></a><!-- doxytag: member="alvar::Kalman::prev_tick" ref="a4121d0507501f60021622d833c373e8a" args="" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><b>prev_tick</b></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p><a class="el" href="classalvar_1_1_kalman.html" title="Kalman implementation.">Kalman</a> implementation. </p>
<p>The <a class="el" href="classalvar_1_1_kalman.html" title="Kalman implementation.">Kalman</a> filter provides an effective way of estimating a system/process recursively (<a href="http://www.cs.unc.edu/~welch/media/pdf/kalman_intro.pdf">http://www.cs.unc.edu/~welch/media/pdf/kalman_intro.pdf</a>). In this implementation we have separated the <a class="el" href="classalvar_1_1_kalman.html" title="Kalman implementation.">Kalman</a> class (<em><a class="el" href="classalvar_1_1_kalman_core.html" title="Core implementation for Kalman.">KalmanCore</a></em>, <em><a class="el" href="classalvar_1_1_kalman.html" title="Kalman implementation.">Kalman</a></em> or <em><a class="el" href="classalvar_1_1_kalman_ekf.html" title="Extended Kalman Filter (EKF) implementation.">KalmanEkf</a></em>) from the sensor class (<em><a class="el" href="classalvar_1_1_kalman_sensor_core.html" title="Core implementation for Kalman sensor.">KalmanSensorCore</a></em>, <em><a class="el" href="classalvar_1_1_kalman_sensor.html" title="Kalman sensor implementation.">KalmanSensor</a></em> or <em><a class="el" href="classalvar_1_1_kalman_sensor_ekf.html" title="Extended Kalman Filter (EKF) sensor implementation.">KalmanSensorEkf</a></em>). The selected <a class="el" href="classalvar_1_1_kalman.html" title="Kalman implementation.">Kalman</a> class contains always the latest estimation of the process. The estimation can be updated using one or several sensors. This implementation allows SCAAT approach, where there may be several sensors (and several controls) for each <a class="el" href="classalvar_1_1_kalman.html" title="Kalman implementation.">Kalman</a> filter (See <a href="http://www.cs.unc.edu/~welch/scaat.html">http://www.cs.unc.edu/~welch/scaat.html</a>).</p>
<p>Currently we have have three levels of implementations for both <a class="el" href="classalvar_1_1_kalman.html" title="Kalman implementation.">Kalman</a> and Sensor (<em>core</em>, <em>"normal"</em> and <em>EKF</em>).</p>
<p>The <em>core</em> implementations can be used for really fast bare-bones core implementations when we have precalculated and constant <em>K</em>. In systems where <em>F</em>, <em>H</em>, <em>Q</em> and <em>R</em> are constants the <em>K</em> will converge into a constant and it can be precalculated. Note, that the core implementation need to assume constant frame rate if <em>F</em> depends on the timestep between frames. Note also, that the core-classes cannot use <em>EKF</em> Jacobians because they change the <em>H</em>.</p>
<p>The <em>"normal"</em> implementations are used when we have a linear <em>F</em> for <em><a class="el" href="classalvar_1_1_kalman.html" title="Kalman implementation.">Kalman</a></em>, or linear <em>H</em> for <em><a class="el" href="classalvar_1_1_kalman_sensor.html" title="Kalman sensor implementation.">KalmanSensor</a></em>. The <em>EKF</em> implementations are used when we have non-linear function <em>f()</em> for <em><a class="el" href="classalvar_1_1_kalman_ekf.html" title="Extended Kalman Filter (EKF) implementation.">KalmanEkf</a></em>, or non-linear function <em>h()</em> for <em><a class="el" href="classalvar_1_1_kalman_sensor_ekf.html" title="Extended Kalman Filter (EKF) sensor implementation.">KalmanSensorEkf</a></em>.</p>
<p>Furthermore we have a class <em><a class="el" href="classalvar_1_1_kalman_visualize.html" title="Class for visualizing Kalman filter.">KalmanVisualize</a></em> for visualizing the internal state of <em><a class="el" href="classalvar_1_1_kalman.html" title="Kalman implementation.">Kalman</a></em>.</p>
<p>Note, that now the <em>KalmanControl</em> is left out from this implementation. But it could be added using similar conventions as the <em><a class="el" href="classalvar_1_1_kalman_sensor.html" title="Kalman sensor implementation.">KalmanSensor</a></em>. </p>
<dl><dt><b>Examples: </b></dt><dd>
<p><a class="el" href="_sample_filter_8cpp-example.html#_a5">SampleFilter.cpp</a>.</p>
</dd>
</dl>
<p>Definition at line <a class="el" href="_kalman_8h_source.html#l00178">178</a> of file <a class="el" href="_kalman_8h_source.html">Kalman.h</a>.</p>
<hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="add0d3881af973546a257fd6e1dcd8298"></a><!-- doxytag: member="alvar::Kalman::Kalman" ref="add0d3881af973546a257fd6e1dcd8298" args="(int _n)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classalvar_1_1_kalman.html">Kalman</a> </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>_n</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Constructor. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>n</em>&nbsp;</td><td>The number of items in the <a class="el" href="classalvar_1_1_kalman.html" title="Kalman implementation.">Kalman</a> state vector </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>_m</em>&nbsp;</td><td>The number of measurements given by this sensor </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a60532ff38a0447a6e4e1f78f108284a3"></a><!-- doxytag: member="alvar::Kalman::predict" ref="a60532ff38a0447a6e4e1f78f108284a3" args="(unsigned long tick)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">CvMat* predict </td>
          <td>(</td>
          <td class="paramtype">unsigned long&nbsp;</td>
          <td class="paramname"> <em>tick</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Predict the <a class="el" href="classalvar_1_1_kalman.html" title="Kalman implementation.">Kalman</a> state vector for the given time step This calls <em>updateF</em> for updating the transition matrix based on the real time step. </p>
<p>x_pred = F*x P_pred = F*P*trans(F) + Q </p>

</div>
</div>
<a class="anchor" id="aedfe0c641afbd94cf40850de332a0fb4"></a><!-- doxytag: member="alvar::Kalman::update_F" ref="aedfe0c641afbd94cf40850de332a0fb4" args="(unsigned long tick)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual void update_F </td>
          <td>(</td>
          <td class="paramtype">unsigned long&nbsp;</td>
          <td class="paramname"> <em>tick</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>If your transition matrix F is based on time you need to override this method. </p>

<p>Reimplemented in <a class="el" href="classalvar_1_1_kalman_ekf.html#aedfe0c641afbd94cf40850de332a0fb4">KalmanEkf</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li><a class="el" href="_kalman_8h_source.html">Kalman.h</a></li>
</ul>
</div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Tue May 29 18:20:30 2012 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
